# config.py

import os
import json
from http.cookies import SimpleCookie

# Gá»‘c cá»§a module fb_stalker (absolute path)
BASE_DIR = os.path.dirname(os.path.abspath(__file__))
BASE_NAME = "fb_stalker"

# Äá»‹nh nghÄ©a thÆ° má»¥c lÆ°u video vÃ  lá»‹ch sá»­
VIDEO_DIR = os.path.join(BASE_DIR, 'videos')
HISTORY_FILE = os.path.join(BASE_DIR, 'history', 'video_history.json')
COOKIES_PATH = os.path.join(BASE_DIR, 'cookies', 'facebook_cookies.json')
PROFILE_DIR = os.path.join(BASE_DIR, 'cookies', 'facebook_profile')
STEALTH_SCRIPT = os.path.join(BASE_DIR, 'stealth.js')
FANPAGES = os.path.join(BASE_DIR, 'pages.txt')

# ThÆ° má»¥c chá»©a cookie dáº¡ng Netscape
NETSCAPE_DIR = os.path.join(BASE_DIR, 'netscape')
os.makedirs(NETSCAPE_DIR, exist_ok=True)


# Thá»i gian nghá»‰ giá»¯a cÃ¡c vÃ²ng vÃ  Thá»i gian delay giá»¯a fanpage nÃ y vÃ  fanpage khÃ¡c
WAIT_BETWEEN_ROUNDS = 60
DELAY_TIME = 10
STALKER_MOUSE_WHEEL = 1500

# NhÃ³m sá»‘ lÆ°á»£ng stalkers Ä‘Æ°á»£c phÃ©p hoáº¡t Ä‘á»™ng Ä‘á»“ng thá»i
BATCH_SIZE = 5

# facebook_cookies.json láº¥y Ä‘Æ°á»£c sau khi login -> convert sang dáº¡ng facebook_cookies_netscape lÆ°u vÃ o /netscape
def convert_json_to_netscape(cookies_json, output_file=None):
    """
    Chuyá»ƒn Ä‘á»•i cookies tá»« Ä‘á»‹nh dáº¡ng JSON sang Netscape.
    Máº·c Ä‘á»‹nh output vÃ o netscape/facebook_cookies_netscape.txt
    """
    if output_file is None:
        output_file = os.path.join(NETSCAPE_DIR, 'facebook_cookies_netscape.txt')

    with open(cookies_json, 'r', encoding='utf-8') as f:
        cookies = json.load(f)

    with open(output_file, 'w', encoding='utf-8') as f:
        f.write("# Netscape HTTP Cookie File\n")
        f.write("# https://www.netscape.com/newsref/std/cookie_spec.html\n")
        f.write("# This file was generated by Python.\n")

        for cookie in cookies:
            domain = cookie.get('domain', '')
            path = cookie.get('path', '/')
            expires = cookie.get('expires')
            expiry = str(int(expires)) if expires else '0'
            name = cookie.get('name', '')
            value = cookie.get('value', '')
            secure = 'TRUE' if cookie.get('secure', False) else 'FALSE'
            include_sub = 'TRUE' if domain.startswith('.') else 'FALSE'
            f.write(f"{domain}\t{include_sub}\t{path}\t{secure}\t{expiry}\t{name}\t{value}\n")

    print(f"ğŸŒ ÄÃ£ chuyá»ƒn cookies sang Ä‘á»‹nh dáº¡ng Netscape vÃ  lÆ°u vÃ o {output_file}")
    return output_file

def save_metadata_to_history(metadata):
    history = []
    with open(HISTORY_FILE, 'r', encoding='utf-8') as f:
        history = json.load(f)

    # ThÃªm má»›i vÃ  lÆ°u láº¡i
    history.append(metadata)
    with open(HISTORY_FILE, 'w', encoding='utf-8') as f:
        json.dump(history, f, indent=2, ensure_ascii=False)

    print(f"ğŸ’¾ğŸ’¾ğŸ’¾ğŸ’¾ğŸ’¾ ÄÃ£ lÆ°u metadata vÃ o {HISTORY_FILE}")